---
import { getCollection, render } from 'astro:content'
import BaseLayout from '../../layouts/BaseLayout.astro'
import Card from '../../components/Card.astro'
import Logo from '../../components/Logo.astro'
import Footer from '../../components/Footer.astro'
import CTASection from '../../components/CTASection.astro'
import { Icon } from 'astro-icon/components'
import { siteConfig } from '../../data/site'

export async function getStaticPaths() {
  const projects = await getCollection('projects')
  return projects.map((project) => ({
    params: { slug: project.id },
    props: { project },
  }))
}

const { project } = Astro.props
const { Content } = await render(project)
---

<BaseLayout title={`${project.data.title} â€“ ${siteConfig.name}`} description={project.data.excerpt} ogImage={`/og/projects/${project.id}.png`}>
  <Card>
    <header class="relative mb-12">
      <div class="flex items-center gap-4 mb-4">
        {project.data.logo ? (
          <div class="relative w-10 h-10 rounded-lg bg-slate-100 border border-slate-200 flex items-center justify-center overflow-hidden shrink-0">
            <img src={project.data.logo} alt="" class="w-full h-full object-contain p-1.5 relative z-0" />
            <div class="absolute inset-0 bg-slate-500 mix-blend-color opacity-80 z-10"></div>
          </div>
        ) : (
          <div class="w-10 h-10 rounded-lg bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-400 shrink-0">
            <Icon name={project.data.icon} class="size-5" />
          </div>
        )}
        <div>
          <h1 class="text-2xl sm:text-3xl font-medium text-slate-900 tracking-tight leading-tight">
            {project.data.title}
          </h1>
          <p class="text-xs text-slate-500 mt-1">{project.data.tags} &middot; {project.data.year}</p>
        </div>
      </div>

      <p class="text-base text-slate-600 leading-relaxed">
        {project.data.excerpt}
      </p>

      {project.data.url && (
        <a
          href={project.data.url}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 mt-4 text-sm text-slate-500 hover:text-slate-800 transition-colors"
        >
          <Icon name="solar:link-round-linear" class="size-4" aria-hidden="true" />
          {new URL(project.data.url).hostname.replace('www.', '')}
          <span class="sr-only">(opens in new tab)</span>
        </a>
      )}
    </header>

    <article class="prose prose-slate prose-sm max-w-none
      prose-headings:font-heading prose-headings:tracking-tight
      prose-h2:text-lg prose-h2:mt-10 prose-h2:mb-4
      prose-h3:text-base prose-h3:mt-6 prose-h3:mb-3
      prose-p:text-slate-600 prose-p:leading-relaxed
      prose-strong:text-slate-700 prose-strong:font-medium
      prose-li:text-slate-600
      prose-ul:my-4">
      <Content />
    </article>

    <CTASection bookingUrl={siteConfig.bookingUrl} />

    <Footer name={siteConfig.name} location={siteConfig.location} timezone={siteConfig.timezone} />
  </Card>
</BaseLayout>
